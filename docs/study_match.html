<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Documentation for MATCH - 1&nbsp; MATCH (Fronk Dissertation)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./study_match.html">Studies</a></li><li class="breadcrumb-item"><a href="./study_match.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">MATCH (Fronk Dissertation)</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Documentation for MATCH</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/jjcurtin/docs_match" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Studies</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./study_match.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">MATCH (Fronk Dissertation)</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#specific-aims" id="toc-specific-aims" class="nav-link active" data-scroll-target="#specific-aims"><span class="header-section-number">1.1</span> Specific Aims</a></li>
  <li><a href="#approach" id="toc-approach" class="nav-link" data-scroll-target="#approach"><span class="header-section-number">1.2</span> Approach</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">1.2.1</span> Data</a></li>
  <li><a href="#model-fitting" id="toc-model-fitting" class="nav-link" data-scroll-target="#model-fitting"><span class="header-section-number">1.2.2</span> Model Fitting</a></li>
  </ul></li>
  <li><a href="#analysis-plan" id="toc-analysis-plan" class="nav-link" data-scroll-target="#analysis-plan"><span class="header-section-number">1.3</span> Analysis Plan</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview"><span class="header-section-number">1.3.1</span> Overview</a></li>
  <li><a href="#specific-steps" id="toc-specific-steps" class="nav-link" data-scroll-target="#specific-steps"><span class="header-section-number">1.3.2</span> Specific Steps</a></li>
  </ul></li>
  <li><a href="#project-notes" id="toc-project-notes" class="nav-link" data-scroll-target="#project-notes"><span class="header-section-number">1.4</span> Project Notes</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jjcurtin/docs_match/edit/main/study_match.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">MATCH (Fronk Dissertation)</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><strong>Project Members</strong>: Gaylen Fronk, John Curtin, Megan Piper, Tim Baker</p>
<p><strong>Dissertation/Mentoring Committee Members</strong>: John Curtin, Megan Piper, James Li, Craig Berridge, Kate Walsh, Linnea Burk</p>
<p><strong>Estimated Defense</strong>: June 2024</p>
<section id="specific-aims" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="specific-aims"><span class="header-section-number">1.1</span> Specific Aims</h2>
<p>Precision mental health is the application of the precision medicine paradigm to mental health conditions. Whereas traditional treatment selection relies on population-level treatment effectiveness, precision mental health guides treatment selection using individual difference characteristics likely to predict treatment success for each patient. Several factors have hindered research progress towards treatment selection via precision mental health models. First, traditional analytic techniques cannot account for the complex (high-dimensional) relationships between individual differences and treatment success necessary for robust, precise, person-level prediction. Thus, extant research has been unable to capture the real-world complexities of treatment response and recovery. Second, precision mental health research has built and evaluated models in the same samples. Consequently, these models become overfit to the development sample and do not generalize well to new data. This approach prevents precision mental health models from accurately guiding treatment selection in new patients.</p>
<p>Contemporary machine learning approaches are well-suited to overcome these limitations of previous precision mental health research. Machine learning models can accommodate high-dimensional arrays of features, and generalize robustly to new samples of patients. These approaches allow us to build models that are simultaneously complex enough to capture real-world relationships and generalizable enough to permit precise, person-level prediction.</p>
<p>The proposed project represents a tangible application of the precision mental health paradigm using modern machine learning approaches. This project would produce a decision-making tool to select among cigarette smoking cessation treatments for individuals looking to quit smoking. Cigarette smoking remains a critical and costly public health crisis. Existing treatments are only modestly effective at best. Additionally, treatments are similarly effective at the population level, meaning that even population-level effectiveness cannot guide treatment selection for individuals quitting smoking. Thus, deciding among first-line (i.e., FDA-approved) smoking cessation medications is a specific, objective decision that many smokers must make. Successful application of the precision mental health paradigm to cigarette smoking cessation would have immediate clinical benefit. It would also serve as a template for how to improve treatment outcomes across substance use disorders.</p>
<p>Specifically, this project pursues the following aims:</p>
<p><strong>AIM 1: Build a machine learning model to guide treatment selection for cigarette smoking cessation.</strong> We will build a machine learning model to predict treatment success (i.e., 4-week point-prevalence abstinence from smoking) for people who smoke who received one of three cigarette smoking cessation treatments. This model will use clinical features (predictors) from a richly characterized sample of people who smoke from a previously completed randomized controlled trial. The model will produce probabilities of treatment success for each treatment such that it can guide selection of the best treatment for any specific individual.</p>
<p><strong>AIM 2: Evaluate the clinical benefit of using a treatment selection machine learning model.</strong> Using the best model identified in <strong>AIM 1</strong>, we will identify the treatment for each person that gives them the highest likelihood of abstinence at 6 months by comparing predicted probabilities of abstinence for each participant for each treatment. We will evaluate the clinical benefit of this approach in two complementary ways. First, we will compare the aggregate predicted (i.e., model-based) treatment success to observed treatment success from the original trial. Second, we will compare the observed trial abstinence of individuals who (randomly) received their best treatment with the observed trial abstinence of individuals who did not.</p>
</section>
<section id="approach" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="approach"><span class="header-section-number">1.2</span> Approach</h2>
<section id="data" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="data"><span class="header-section-number">1.2.1</span> Data</h3>
<p>The data come from a completed RCT comparing the effectiveness of varenicline, combination nicotine replacement therapy (C-NRT), and nicotine patch. 1086 daily cigarette smokers were enrolled beginning several weeks before a target quit date and for at least 6 months following quitting smoking. Participants were randomly assigned to 12 weeks of medication treatment.</p>
<p>The sample was comprehensively assessed for individual differences at baseline including tobacco-related, psychological, physical health, demographic, and social/environmental variables. There are 414 individual difference characteristics. Treatment will also be included as a feature in all models and allowed to interact with other features.</p>
<p>The model outcome is treatment success (abstinent vs.&nbsp;smoking) based on participants’ self-reported past-week smoking 4 weeks after quitting and confirmed biologically via exhaled CO. <em>Note</em>: This represents a change from an original outcome of 6 months post-quit following preliminary analyses and discussions with mentoring committee.</p>
</section>
<section id="model-fitting" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="model-fitting"><span class="header-section-number">1.2.2</span> Model Fitting</h3>
<p>I will engineer features from raw predictors using procedures that represent categorical predictors numerically, address distributional shape, and impute missing data. I will use dimensionality reduction approaches (data- and domain-driven) to reduce the number of features in the models. I will consider glmnet, xgboost, and random forest classification statistical algorithms, which represent a wide range of characteristics.</p>
<p>I will use nested cross-validation, with 1 repeat of 10X CV on the inner loop and 3 repeats of 10X CV on the outer loop. Best models are selected using validation sets in the inner loop and evaluated using tests sets in the outer loop. Models will be selected and evaluated using area under the receiving operator characteristic curve (auROC).</p>
</section>
</section>
<section id="analysis-plan" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="analysis-plan"><span class="header-section-number">1.3</span> Analysis Plan</h2>
<section id="overview" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="overview"><span class="header-section-number">1.3.1</span> Overview</h3>
<p>I will develop and select the best model configuration to predict treatment success (<strong>AIM 1</strong>). I will then fit that best configuration to the full sample to produce a final model. I will use this final model as the starting point for <strong>AIM 2</strong>.</p>
<p>I will obtain a prediction for the likelihood of treatment success for each smoker had they received nicotine patch, C-NRT, and varenicline (3 predicted scores per participant). For each smoker, they will be “assigned” to the treatment that gives them the highest predicted chance of quitting. Thus, for each participant, I will have a) the treatment the model would have selected, and b) the predicted likelihood of quitting using that “best” treatment.</p>
<p>I will then evaluate clinical benefit in two ways:</p>
<ol type="1">
<li><p>I will use Bayesian estimation to compare the aggregate predicted treatment success (i.e., across participants) to observed treatment success in the original trial. This will allow me to quantify and compare statistically the difference in percent abstinence across the two treatment selection methods.</p></li>
<li><p>I will use Bayesian estimation to compare the observed trial abstinence of individuals who (randomly) received their best treatment with the observed trial abstinence of individuals who did not. This second approach offers the benefit of using only objective (observed) rather than predicted outcomes.</p></li>
</ol>
</section>
<section id="specific-steps" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="specific-steps"><span class="header-section-number">1.3.2</span> Specific Steps</h3>
<section id="aim-1" class="level4" data-number="1.3.2.1">
<h4 data-number="1.3.2.1" class="anchored" data-anchor-id="aim-1"><span class="header-section-number">1.3.2.1</span> AIM 1</h4>
<ol type="1">
<li><p>Data cleaning, cleaning EDA, modeling EDA (<em>Completed</em>)</p></li>
<li><p>Inner loop model fitting at CHTC (<em>Completed</em>)</p></li>
<li><p>Model selection &amp; evaluation (<em>Completed</em>)</p></li>
</ol>
<ul>
<li><p>Select best models for each outer fold based on validation set auROCs (1_metrics_inner) (<em>Completed</em>)</p></li>
<li><p>Evaluate best models based on test set auROCs &amp; calibrate probabilities using beta distribution (2_metrics_outer) (<em>Completed</em>)</p></li>
<li><p>In-depth evaluation of best models (3_eval_outer) (<em>Completed</em>)</p></li>
</ul>
<ol start="4" type="1">
<li>Fit single best model (<em>Completed</em>)</li>
</ol>
<ul>
<li><p>1x 10-fold simple CV in the full dataset (mimic inner loop process), select model with best auROC across 10 held-out folds (<em>Completed</em>)</p></li>
<li><p>Refit best configuration in the full dataset (<em>Completed</em>)</p></li>
</ul>
<ol start="5" type="1">
<li><p>Conduct SHAP on single best model using 1X 10-fold held-out folds (<em>In progress</em>)</p></li>
<li><p>Bayesian analyses: posterior probability distributions around model performance to determine likelihood of prediction signal (distribution does not include 0.5) (<em>In progress</em>)</p></li>
</ol>
<p><strong>AIM 1 Supplemental Analyses</strong></p>
<ol type="1">
<li><p>Model training, selection, &amp; evaluation with 6-month outcome, follow steps 2 &amp; 3 above</p></li>
<li><p>Bayesian analyses: comparisons of posterior probability distributions between 1-month and 6-month test set auROCs (30 held-out folds from outer loop of nested CV)</p></li>
</ol>
</section>
<section id="aim-2" class="level4" data-number="1.3.2.2">
<h4 data-number="1.3.2.2" class="anchored" data-anchor-id="aim-2"><span class="header-section-number">1.3.2.2</span> AIM 2</h4>
<ol type="1">
<li>Use final model to generate predicted probabilities for each participant for each treatment (3 per person) (<em>Completed</em>)</li>
</ol>
<ul>
<li><p>Make features using recipe trained from full dataset (<em>Completed</em>)</p></li>
<li><p>Predict into full-data feature set: 3 probabilities per participant, one per treatment (triplicate dataset and substitute treatments) (<em>Completed</em>)</p></li>
<li><p>Calibrate probabilities (<em>Completed</em>)</p></li>
<li><p>Subsequent dataframe should include: subid, RCT tx, observed outcome, 3X probabilities, best tx (<em>Completed</em>)</p></li>
</ul>
<ol start="2" type="1">
<li><p><em>Validity analysis</em>: compare sample-average observed abstinence (means of 0s and 1s) to predicted probabilities from RCT tx. This will show how well the model predictions match observed cases. Do this across calibration methods to determine which (if any) best matches observed outcomes (<em>Completed</em>)</p></li>
<li><p>Quantify clinical benefit: Method 1</p></li>
</ol>
<ul>
<li><p>Extract best treatment probability for each participant</p></li>
<li><p>Bayesian comparison of predicted probabilities with observed abstinence (across all treatments/full sample)</p></li>
</ul>
<ol start="4" type="1">
<li>Quantify clinical benefit: Method 2</li>
</ol>
<ul>
<li><p>Label each participant as assigned best treatment or not (RCT tx == best tx, T/F)</p></li>
<li><p>Bayesian comparison of abstinence rates for individuals assigned best treatment (vs.&nbsp;not) using only observed abstinence</p></li>
</ul>
</section>
</section>
</section>
<section id="project-notes" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="project-notes"><span class="header-section-number">1.4</span> Project Notes</h2>
<p>1/24/24: decided to include supplemental analyses with 6-month outcomes, anticipating this as a committee request that would be time-consuming to do as a revision. Only go through inner and outer loops of nested (i.e., until I have 30 held-out auROCs for Bayesian model comparisons)</p>
<p>1/24/24: added validity analysis (Aim 2, point 2). Validity check as to how accurately the model is predicting the observed abstinence rates in the sample.</p>
<p>2/9/24: decided with John via Slack that we would do SHAP using the single, best selected model but using held-out folds from 1x 10-fold simple k-fold. Will also do SHAP at CHTC because of computational cost</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Welcome</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>